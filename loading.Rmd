---
title: "Untitled"
author: "František Kalvas"
date: '2022-05-02'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
#### SKript pro načtení, vyčištění a uložení dat pro seminář KSS/PV1

## Encoding: windows-1250
## Vytvořil: 2022-05-02 FrK
## Upravil:  2022-05-02 FrK

## Notes:
#  1) v první řadě načtu všechna data
#  2) zkusím sice vše, ale když bude problém, přednost mají ta troje data, která doprovází otázky
#  3) data využiju na zadání úkolu č. 8 a snad i 9 pro KSS/KA1
#



# Hlavička ----------------------------------------------------------------

# Promazání
rm(list = ls())

# Packages
library(readr)
library(readxl)
library(writexl)
library(dplyr)
library(forcats)
library(tidyr)
library(tibble)

# Vlastni funkce
prejmenuj = function(data, pozice, jmena) {
  names(data)[pozice] = jmena
  data
}


# Načítání ----------------------------------------------------------------

## data1
df1 = read_xlsx("data1.xlsx") %>%
  select(3, 4, 6, 10, 13) %>%
  prejmenuj(1:5, c("Pohlaví", "Věk", "Děti", "Adopce", "Adopce postiženého")) %>%
  mutate(across(.cols = everything(), ~factor(.x)))

# Uložení vyčištěných dat pro KSS/KA1
write_xlsx(df1, "../KSS-KA1/!data/df1.xlsx")



## data2
df2 = read_xlsx("data2.xlsx") %>%
  select(4, 10, 5:7) %>%
  prejmenuj(1:5, c("Vzdělání", "Informovanost", "Svědek", "Způsobeno neinformovaností", "Důležitý problém"))%>%
  mutate(
    Vzdělání =
      recode(
        Vzdělání,
        `Odborné učiliště s výučním listem` = "Vyučen/a", `Střední škola s maturitou` = "SŠ",
        `Vysoká škola (bakalářské studium)` = "VŠ", `Vysoká škola (magisterské studium)` = "VŠ",
        `Vyšší odborné vzdělání` = "SŠ", `Základní škola` = "ZŠ") %>%
      factor(levels = c("ZŠ", "Vyučen/a", "SŠ", "VŠ")),
    Informovanost = factor(Informovanost, levels = c("Ano", "Spíše ano", "Spíše ne", "Ne")),
    `Způsobeno neinformovaností` = factor(`Způsobeno neinformovaností`, levels = c("Ano", "Spíše ano", "Spíše ne", "Ne")),
    across(.cols = everything(), ~factor(.x))
    )

# Uložení vyčištěných dat pro KSS/KA1
write_xlsx(df2, "../KSS-KA1/!data/df2.xlsx")



## df3
df3 = read_csv("data3.csv") %>% 
  select(2:6, 8) %>% 
  prejmenuj(1:6, c("Věk", "Pohlaví", "Vzdělání", "Ví", "Co", "Prevence")) %>% 
  rowid_to_column("ID") %>% 
  separate(Co, into = paste0("pol", 1:4), sep = ";") %>% 
  pivot_longer(6:9, values_to = "Uvedeno") %>% 
  select(-name) %>% 
  filter(!is.na(Uvedeno))

df3 %>% 
  ggplot() +
  aes(x = Uvedeno, fill = Uvedeno) +
  geom_bar()



```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
